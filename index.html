<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>One Screen</title>
<script language="javascript" src="src/utils.js"></script>
<script language="javascript" src="src/tile.js"></script>
<script language="javascript" src="src/tilemap.js"></script>
<script language="javascript" src="src/sprite.js"></script>
<script language="javascript" src="src/actor.js"></script>
<script language="javascript" src="src/scene.js"></script>
<script language="javascript" src="src/overlay.js"></script>
<script language="javascript" src="src/game.js"></script>
<script language="javascript">
function run()
{
  function getprops(a) {
    var d = {};
    for (var i = 0; i < a.length; i++) { d[a[i].id] = a[i]; }
    return d;
  }
  var framerate = 30;
  var images = getprops(document.getElementsByTagName('img'));
  var audios = getprops(document.getElementsByTagName('audio'));
  var labels = getprops(document.getElementsByClassName('label'));
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var game = new Game(framerate, canvas, images, audios, labels);
  function idle() {
    if (game.active) {
      game.idle();
      game.repaint(ctx);
    }
  };
  window.setInterval(idle, 1000/framerate);
  window.addEventListener('keydown', function (e) { game.keydown(e); });
  window.addEventListener('keyup', function (e) { game.keyup(e); });
  window.addEventListener('focus', function (e) { game.focus(e); game.repaint(ctx); });
  window.addEventListener('blur', function (e) { game.blur(e); game.repaint(ctx); });
  game.init();
}
</script>
<body style="background:#61E8A4;" onload="run();">
<div align=center>
  <div style="position:relative; width:640px;">
    <canvas id="canvas" style="position:absolute; top:0; left:0; background:#61E8A4;"
	    width="800" height="800"></canvas>
    <div class="label" id="time" style="position:absolute; top:0; left:0px; color:black;"></div>
    <div class="label" id="health" style="position:absolute; top:0; left:100px; color:black;"></div>
  </div>
</div>
<div style="display:none;">
  <img id="tiles_floor" src="assets/images/tilemap_floor.png">
  <img id="sprites_floor" src="assets/images/spritesheet_floor.png">
  <img id="tiles_wall" src="assets/images/tilemap_walls.png">
  <img id="sprites_wall" src="assets/images/spritesheet_walls.png">
  <img id="tiles_lava" src="assets/images/tilemap_lava.png">
  <img id="sprites_lava" src="assets/images/spritesheet_lava.png">
  <img id="tiles_ice" src="assets/images/tilemap_ice.png">
  <img id="sprites_ice" src="assets/images/spritesheet_ice.png">
  <img id="tiles_spikes" src="assets/images/tilemap_spikes.png">
  <img id="sprites" src="assets/images/sprites.png">
  <img id="shadow" src="assets/images/shadow.png">
  <img id="title" src="assets/images/title.png">
  <img id="gameover" src="assets/images/gameover.png">
  <audio id="jump" type="audio/mpeg" src="assets/sounds/jump.mp3" preload="auto"></audio>
  <audio id="pick" type="audio/mpeg" src="assets/sounds/pick.mp3" preload="auto"></audio>
  <audio id="hurt" type="audio/mpeg" src="assets/sounds/Death_Water.mp3" preload="auto"></audio>
  <audio id="intro" type="audio/mpeg" src="assets/musics/intro_jingle_2.mp3" preload="auto">-1</audio>
  <audio id="music" type="audio/mpeg" src="assets/musics/Guitar1.mp3" preload="auto">-0.2</audio>
</div>
</body>
